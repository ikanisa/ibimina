# ============================================================
# Ibimina Staff Console Environment Template
# Copy this file to .env and replace the placeholder values.
# Required entries are grouped first, followed by optional helpers.
# ============================================================

# ------------- Required application configuration -------------
# Runtime environment label (development, staging, production).
APP_ENV=development
# Supabase project URL used by the Next.js client.
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
# Supabase anon/public key for browser calls (keep RLS enabled).
NEXT_PUBLIC_SUPABASE_ANON_KEY=public-anon-key
# Supabase service URL for server-side workers and webhooks.
SUPABASE_URL=https://your-project.supabase.co
# Supabase service-role key for server actions and API routes.
SUPABASE_SERVICE_ROLE_KEY=service-role-key
# Base64-encoded 32-byte key for encrypting sensitive fields.
KMS_DATA_KEY_BASE64=base64-encoded-32-byte-key
# Hex-encoded pepper shared across backup code hashing.
BACKUP_PEPPER=hex-64-character-backup-pepper
# Hex-encoded secret for MFA session cookies.
MFA_SESSION_SECRET=hex-64-character-mfa-secret
# Hex-encoded secret for trusted device cookies.
TRUSTED_COOKIE_SECRET=hex-64-character-trusted-secret
# Hex-encoded HMAC secret for edge function/webhook verification.
HMAC_SHARED_SECRET=hex-64-character-hmac-secret
# From email used for MFA mailers and operational alerts.
MFA_EMAIL_FROM=security@example.com
# Locale for MFA emails (en, rw, fr).
MFA_EMAIL_LOCALE=en

# ------------- Optional public configuration -------------
# Canonical origin for passkeys and redirect helpers (leave commented to infer from request host).
# NEXT_PUBLIC_SITE_URL=https://staff.example.com
# Enable deterministic builds when running in CI.
NEXT_PUBLIC_BUILD_ID=local-build

# ------------- Optional server configuration -------------
# Override default port for `pnpm dev` / `pnpm start`.
PORT=3000
# Override automatic passkey relying party detection (commented keeps request-derived defaults).
# MFA_RP_ID=staff.example.com
# Override automatic MFA origin detection (commented keeps request-derived defaults).
# MFA_ORIGIN=https://staff.example.com
# Friendly relying party name shown in authenticator prompts.
MFA_RP_NAME=Ibimina Staff Console
# Session lifetime (seconds) for MFA cookies.
MFA_SESSION_TTL_SECONDS=43200
# Session lifetime (seconds) for trusted device cookies.
TRUSTED_DEVICE_TTL_SECONDS=2592000
# Secondary peppers when isolating rate limit or OTP hashing.
RATE_LIMIT_SECRET=hex-64-character-rate-secret
EMAIL_OTP_PEPPER=hex-64-character-otp-pepper
# Sign CSV exports and tamper-proof analytics caches.
REPORT_SIGNING_KEY=hex-64-character-report-secret
# Optional KMS key in hex form (use instead of KMS_DATA_KEY_BASE64).
KMS_DATA_KEY=hex-64-character-kms-key
# Primary site origin used by server-rendered URLs (leave commented for localhost).
# SITE_URL=https://staff.example.com
# Base URL for Supabase Edge functions used in smoke tests.
EDGE_URL=https://your-project.supabase.co/functions/v1
# SMTP sender used for transactional email fallbacks.
MAIL_FROM="Ibimina Ops <no-reply@staff.example.com>"
# SMTP host for fallback mail delivery.
SMTP_HOST=smtp.example.com
# SMTP authentication user (if required).
SMTP_USER=apikey
# SMTP authentication password (if required).
SMTP_PASS=super-secret-password
# SMTP port for fallback mail delivery.
SMTP_PORT=587
# Observability webhook endpoint for production log drains.
LOG_DRAIN_URL=https://logs.example.com/webhook
# Bearer token when publishing to the log drain endpoint.
LOG_DRAIN_TOKEN=log-drain-token
# Source label forwarded with log drain payloads.
LOG_DRAIN_SOURCE=nextjs-admin
# HTTP timeout (ms) for log drain deliveries.
LOG_DRAIN_TIMEOUT_MS=2000
# Alert webhook invoked when log drains fail repeatedly.
LOG_DRAIN_ALERT_WEBHOOK=https://hooks.example.com/ops-alerts
# Bearer token for the alert webhook endpoint.
LOG_DRAIN_ALERT_TOKEN=log-alert-token
# Cooldown window (ms) between alert notifications.
LOG_DRAIN_ALERT_COOLDOWN_MS=300000
# Set to 1 to suppress log drain errors in noisy environments.
LOG_DRAIN_SILENT=0
# Cache revalidation token for analytics edge routes.
ANALYTICS_CACHE_TOKEN=analytics-cache-token

# ------------- Optional integrations -------------
# Resend API key for transactional email delivery.
RESEND_API_KEY=re_XXXXXXXXXXXXXXXXXXXXXXXX
# OpenAI API key for AI-assisted reconciliation flows.
OPENAI_API_KEY=sk-XXXXXXXXXXXXXXXXXXXXXXXX
# Override default OpenAI responses model when needed.
OPENAI_RESPONSES_MODEL=gpt-4.1-mini
# Web Push VAPID public key generated via `npx web-push generate-vapid-keys`.
NEXT_PUBLIC_VAPID_PUBLIC_KEY=BCXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
# Matching VAPID private key generated alongside the public key.
VAPID_PRIVATE_KEY=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
# Contact email for VAPID (RFC 8292 requirement).
VAPID_SUBJECT=mailto:ops@example.com
# Meta WhatsApp Business API credentials for outbound alerts.
META_WHATSAPP_ACCESS_TOKEN=EAAG-XXXXXXXXXXXXXXXXXXXXXXXX
META_WHATSAPP_PHONE_NUMBER_ID=000000000000000
META_WHATSAPP_BUSINESS_ACCOUNT_ID=000000000000000
# Meta App Secret used to validate webhook signatures.
META_WHATSAPP_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# Verification token that must match the Meta webhook configuration.
META_WHATSAPP_VERIFY_TOKEN=verify-token-shared-with-meta
# Optional webhook invoked when WhatsApp delivery fails.
WHATSAPP_ALERT_WEBHOOK=https://hooks.example.com/whatsapp-alerts
# Bearer token included when calling the WhatsApp alert webhook.
WHATSAPP_ALERT_TOKEN=ops-alert-token

# ------------- Edge function tuning -------------
# Historical window (days) for forecasting reconciliations.
FORECAST_LOOKBACK_DAYS=120
# Prediction horizon (days) for forecast outputs.
FORECAST_HORIZON_DAYS=21
# Rate limit window size (seconds) for edge APIs.
RATE_LIMIT_WINDOW_SECONDS=60
# Maximum requests allowed per window for edge APIs.
RATE_LIMIT_MAX=120
# Hours before recon issues auto-escalate to admins.
RECON_AUTO_ESCALATE_HOURS=48
# Minutes before SMS automation escalates to manual review.
SMS_AUTOMATION_THRESHOLD_MINUTES=10
# Maximum SMS ingested per automation batch.
SMS_AUTOMATION_BATCH=25
# REPORT_SIGNING_KEY=
OPENAI_API_KEY=
OPENAI_RESPONSES_MODEL=gpt-4.1-mini
OPENAI_SUPPORT_AGENT_MODEL=gpt-4o-mini
OPENAI_SUPPORT_AGENT_ID=

# ------------- Local testing helpers -------------
# Base URL for E2E tests when running Playwright locally.
PLAYWRIGHT_BASE_URL=http://127.0.0.1:3000
# Stub Supabase project URL for automated tests.
PLAYWRIGHT_SUPABASE_URL=http://127.0.0.1:54321
# Stub anon key for automated tests.
PLAYWRIGHT_SUPABASE_ANON_KEY=stub-anon-key
# Stub service role key for automated tests.
PLAYWRIGHT_SUPABASE_SERVICE_ROLE_KEY=stub-service-role-key
# Stub OpenAI key for offline Playwright flows.
PLAYWRIGHT_OPENAI_API_KEY=stub-openai-key
# Stub HMAC secret for offline Playwright flows.
PLAYWRIGHT_HMAC_SHARED_SECRET=stub-hmac-secret

# ------------- Deployment automation -------------
# Supabase access token used when deploying edge functions.
SUPABASE_ACCESS_TOKEN=sbp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# Supabase project reference (e.g. abcdefghijklmnop).
SUPABASE_PROJECT_REF=your-project-ref
# Vercel project configuration for platform-api deployments.
VERCEL_ORG_ID=team_xxxxxxxxxxxxxxxx
VERCEL_PROJECT_ID=prj_xxxxxxxxxxxxxxxx
VERCEL_TOKEN=vercel.xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
