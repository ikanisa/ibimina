# ============================================================
# Ibimina Staff Console Environment Template
# Copy this file to .env and replace the placeholder values.
# Required entries are grouped first, followed by optional helpers.
# ============================================================

# ------------- Required application configuration -------------
# Runtime environment label (development, staging, production).
APP_ENV=development
# Supabase project URL used by the Next.js client.
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
# Supabase anon/public key for browser calls (keep RLS enabled).
NEXT_PUBLIC_SUPABASE_ANON_KEY=public-anon-key
# Supabase service URL for server-side workers and webhooks.
SUPABASE_URL=https://your-project.supabase.co
# Supabase service-role key for server actions and API routes.
SUPABASE_SERVICE_ROLE_KEY=service-role-key
# Optional stub configuration used when NEXT_PUBLIC_SUPABASE_* are missing in local/dev.
# SUPABASE_ALLOW_STUB=1
# SUPABASE_STUB_URL=http://127.0.0.1:54321
# SUPABASE_STUB_ANON_KEY=stub-anon-key
# Hex-encoded HMAC secret for edge function/webhook verification.
HMAC_SHARED_SECRET=hex-64-character-hmac-secret
# Enable guest mode (1) to bypass authentication and load dashboards directly.
AUTH_GUEST_MODE=0
NEXT_PUBLIC_AUTH_GUEST_MODE=0

# ------------- Optional public configuration -------------
# Canonical origin for redirect helpers (leave commented to infer from request host).
# NEXT_PUBLIC_SITE_URL=https://staff.example.com
# Enable deterministic builds when running in CI.
NEXT_PUBLIC_BUILD_ID=local-build
# Public staging URL used by remote smoke tests.
NEXT_PUBLIC_STAGING_SITE_URL=https://ibimina-staging.netlify.app
# Public analytics key for lightweight telemetry (PostHog, etc.).
NEXT_PUBLIC_POSTHOG_KEY=posthog-public-key
# Optional override for analytics host (defaults to https://app.posthog.com).
NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com

# ------------- Optional server configuration -------------
# Override default port for `pnpm dev` / `pnpm start`.
PORT=3100
# Public origin for the running instance (used by staging smoke tests when
# hosting behind a reverse proxy).
SITE_URL=http://127.0.0.1:3100
# Secondary pepper for rate limit hashing.
RATE_LIMIT_SECRET=hex-64-character-rate-secret
# Sign CSV exports and tamper-proof analytics caches.
REPORT_SIGNING_KEY=hex-64-character-report-secret
# Base URL for Supabase Edge functions used in smoke tests.
EDGE_URL=https://your-project.supabase.co/functions/v1
# Optional webhook for transactional mail sends.
EMAIL_WEBHOOK_URL=https://hooks.example.com/email
# Bearer token included with webhook requests.
EMAIL_WEBHOOK_KEY=email-webhook-token
# SMTP sender used for transactional email fallbacks.
MAIL_FROM="Ibimina Ops <no-reply@staff.example.com>"
# SMTP host for fallback mail delivery.
SMTP_HOST=smtp.example.com
# SMTP authentication user (if required).
SMTP_USER=apikey
# SMTP authentication password (if required).
SMTP_PASS=super-secret-password
# SMTP port for fallback mail delivery.
SMTP_PORT=587
# Observability webhook endpoint for production log drains.
LOG_DRAIN_URL=https://logs.example.com/webhook
# Bearer token when publishing to the log drain endpoint.
LOG_DRAIN_TOKEN=log-drain-token
# Source label forwarded with log drain payloads.
LOG_DRAIN_SOURCE=nextjs-admin
# HTTP timeout (ms) for log drain deliveries.
LOG_DRAIN_TIMEOUT_MS=2000
# Alert webhook invoked when log drains fail repeatedly.
LOG_DRAIN_ALERT_WEBHOOK=https://hooks.example.com/ops-alerts
# Bearer token for the alert webhook endpoint.
LOG_DRAIN_ALERT_TOKEN=log-alert-token
# Cooldown window (ms) between alert notifications.
LOG_DRAIN_ALERT_COOLDOWN_MS=300000
# Set to 1 to suppress log drain errors in noisy environments.
LOG_DRAIN_SILENT=0
# Cache revalidation token for analytics edge routes.
ANALYTICS_CACHE_TOKEN=analytics-cache-token

# ------------- Optional integrations -------------
# Sentry error monitoring (frontend + server)
SENTRY_DSN=https://public@sentry.example/1
NEXT_PUBLIC_SENTRY_DSN=https://public@sentry.example/1
SENTRY_TRACES_SAMPLE_RATE=0.2
SENTRY_PROFILES_SAMPLE_RATE=0.1

# PostHog analytics (optional)
POSTHOG_API_KEY=phc_your_posthog_key
POSTHOG_HOST=https://app.posthog.com

# Resend API key for transactional email delivery.
RESEND_API_KEY=re_XXXXXXXXXXXXXXXXXXXXXXXX
# OpenAI API key for AI-assisted reconciliation flows.
OPENAI_API_KEY=sk-XXXXXXXXXXXXXXXXXXXXXXXX
# Override default OpenAI responses model when needed.
OPENAI_RESPONSES_MODEL=gpt-4.1-mini
# Gemini API key for SMS parsing (alternative to OpenAI)
GEMINI_API_KEY=your-gemini-api-key
# Override default Gemini model (gemini-1.5-flash, gemini-1.5-pro)
GEMINI_MODEL=gemini-1.5-flash
# Android Bridge App HMAC secret for request validation
ANDROID_BRIDGE_HMAC_SECRET=your-secure-random-secret
# Email address for gateway offline alerts
GATEWAY_OFFLINE_ALERT_EMAIL=it-admin@yoursacco.rw
# Threshold in minutes before marking gateway as offline (default: 5)
GATEWAY_OFFLINE_THRESHOLD_MINUTES=5
# Web Push VAPID public key generated via `npx web-push generate-vapid-keys`.
NEXT_PUBLIC_VAPID_PUBLIC_KEY=BCXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
# Matching VAPID private key generated alongside the public key.
VAPID_PRIVATE_KEY=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
# Contact email for VAPID (RFC 8292 requirement).
VAPID_SUBJECT=mailto:ops@example.com
# Meta WhatsApp Business API credentials for outbound alerts.
META_WHATSAPP_ACCESS_TOKEN=EAAG-XXXXXXXXXXXXXXXXXXXXXXXX
META_WHATSAPP_PHONE_NUMBER_ID=000000000000000
META_WHATSAPP_BUSINESS_ACCOUNT_ID=000000000000000
# Meta App Secret used to validate webhook signatures.
META_WHATSAPP_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# Verification token that must match the Meta webhook configuration.
META_WHATSAPP_VERIFY_TOKEN=verify-token-shared-with-meta
# Optional webhook invoked when WhatsApp delivery fails.
WHATSAPP_ALERT_WEBHOOK=https://hooks.example.com/whatsapp-alerts
# Bearer token included when calling the WhatsApp alert webhook.
WHATSAPP_ALERT_TOKEN=ops-alert-token

# ------------- Feature flags & remote config -------------
# ConfigCat SDK key for remote feature flags.
CONFIGCAT_SDK_KEY=configcat-sdk-key
# Flagsmith environment key for remote feature flags.
FLAGSMITH_ENVIRONMENT_KEY=flagsmith-env-key

# ------------- Edge function tuning -------------
# Historical window (days) for forecasting reconciliations.
FORECAST_LOOKBACK_DAYS=120
# Prediction horizon (days) for forecast outputs.
FORECAST_HORIZON_DAYS=21
# Rate limit window size (seconds) for edge APIs.
RATE_LIMIT_WINDOW_SECONDS=60
# Maximum requests allowed per window for edge APIs.
RATE_LIMIT_MAX=120
# Hours before recon issues auto-escalate to admins.
RECON_AUTO_ESCALATE_HOURS=48
# Minutes before SMS automation escalates to manual review.
SMS_AUTOMATION_THRESHOLD_MINUTES=10
# Maximum SMS ingested per automation batch.
SMS_AUTOMATION_BATCH=25

# ------------- Local testing helpers -------------
# Base URL for E2E tests when running Playwright locally.
PLAYWRIGHT_BASE_URL=http://127.0.0.1:3100
# Stub Supabase project URL for automated tests.
PLAYWRIGHT_SUPABASE_URL=http://127.0.0.1:54321
# Stub anon key for automated tests.
PLAYWRIGHT_SUPABASE_ANON_KEY=stub-anon-key
# Stub service role key for automated tests.
PLAYWRIGHT_SUPABASE_SERVICE_ROLE_KEY=stub-service-role-key
# Stub OpenAI key for offline Playwright flows.
PLAYWRIGHT_OPENAI_API_KEY=stub-openai-key
# Stub HMAC secret for offline Playwright flows.
PLAYWRIGHT_HMAC_SHARED_SECRET=stub-hmac-secret

# ------------- Staging smoke tests -------------
# Toggle to run Playwright against remote staging instead of the local dev server.
PLAYWRIGHT_REMOTE=0
# Base URL for staging smoke tests (paired with PLAYWRIGHT_REMOTE=1).
PLAYWRIGHT_REMOTE_BASE_URL=https://ibimina-staging.netlify.app
# Admin credentials used for staging login flows.
PLAYWRIGHT_REMOTE_EMAIL=admin-staging@example.com
PLAYWRIGHT_REMOTE_PASSWORD=super-secret-password
# Target email for invite flow validation (use a catch-all inbox).
PLAYWRIGHT_INVITE_EMAIL=qa-invite@example.com

# ------------- Native shell wrappers -------------
# Override the Capacitor webview origin for native shells.
CAPACITOR_SERVER_URL=https://staff.example.com

# ------------- Deployment automation -------------
# Supabase access token used when deploying edge functions.
SUPABASE_ACCESS_TOKEN=sbp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# Supabase project reference (e.g. abcdefghijklmnop).
SUPABASE_PROJECT_REF=your-project-ref
# Netlify configuration for deployments.
NETLIFY_AUTH_TOKEN=netlify.xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NETLIFY_SITE_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
# Staging Supabase keys consumed by CI smoke tests only.
STAGING_SUPABASE_URL=https://ibimina-staging.supabase.co
STAGING_SUPABASE_ANON_KEY=staging-anon-key
STAGING_SUPABASE_SERVICE_ROLE_KEY=staging-service-role-key
