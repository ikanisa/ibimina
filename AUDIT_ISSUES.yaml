- id: SEC-001
  area: security
  title: "AuthX MFA verify missing rate limiting and replay guard"
  files: ["app/api/authx/challenge/verify/route.ts", "lib/authx/verify.ts"]
  risk: critical
  evidence: "AuthX verification loop lacks throttling and never persists last_mfa_step/failed_mfa_count, so attackers can brute-force or replay TOTP/backup codes." 
  fix: "Add per-user/IP rate limits, persist step counters + failure counts, align with legacy /api/mfa/verify semantics, and emit structured errors." 
  effort: M
- id: SEC-002
  area: security
  title: "WhatsApp OTP issuance unthrottled"
  files: ["lib/authx/start.ts"]
  risk: high
  evidence: "sendWhatsAppOtp inserts codes without rate limits or salted hashes, enabling spam and offline brute force if DB leaked." 
  fix: "Reuse email OTP throttling, add per-issuance salt, expire outstanding codes, and audit sends before enabling channel." 
  effort: M
- id: SEC-003
  area: security
  title: "Supabase Edge Functions expose unauthenticated ingress"
  files: ["supabase/config.toml"]
  risk: high
  evidence: "parse-sms, ingest-sms, sms-inbox, scheduled-reconciliation, metrics-exporter all set verify_jwt=false." 
  fix: "Enforce JWT or shared HMAC per function, log rejected requests, and document signature rotation." 
  effort: M
- id: REL-004
  area: reliability
  title: "Dual MFA stacks risk inconsistent state"
  files: ["components/auth/login-form.tsx", "app/api/mfa/verify/route.ts", "app/api/authx/challenge/verify/route.ts"]
  risk: high
  evidence: "Login posts to /api/mfa/* while AuthX endpoints skip failure counters and set different cookies, creating divergent MFA states." 
  fix: "Unify flows behind AuthX facade, migrate UI to new endpoints, and remove legacy routes after parity tests." 
  effort: L
- id: PWA-005
  area: pwa
  title: "Offline shell lacks dynamic data fallbacks"
  files: ["service-worker.js", "app/offline/page.tsx"]
  risk: medium
  evidence: "SW now precaches offline shell + icons but dashboards still rely on live Supabase calls, leaving empty states when offline beyond cached lists."
  fix: "Add background sync or cached API fallbacks for key dashboards and member lists; surface stale data messaging."
  effort: M
- id: A11Y-006
  area: accessibility
  title: "Quick actions dialog lacks focus trap"
  files: ["components/layout/app-shell.tsx"]
  risk: medium
  evidence: "Overlay closes via click handlers without focus trap or ESC support, trapping keyboard users." 
  fix: "Implement focus management, keyboard dismissal, and aria-current on nav items." 
  effort: S
- id: PERF-007
  area: performance
  title: "Dashboard aggregates computed in memory"
  files: ["lib/dashboard.ts"]
  risk: high
  evidence: "Monthly summary pulls entire payment/member datasets into Node for aggregation, risking latency and memory issues." 
  fix: "Move aggregation into SQL views/materialised tables with pagination." 
  effort: M
- id: PERF-008
  area: performance
  title: "Analytics cache lacks invalidation"
  files: ["lib/analytics.ts", "lib/performance/cache.ts"]
  risk: medium
  evidence: "Executive analytics caches Supabase queries for 15 minutes with no triggers to revalidate, delaying incident response after imports or escalations."
  fix: "Trigger `revalidateTag` from Supabase triggers or expose manual cache bust endpoints and telemetry."
  effort: M
- id: DATA-009
  area: data
  title: "RLS test coverage limited to members"
  files: ["supabase/tests/rls/sacco_staff_access.test.sql"]
  risk: medium
  evidence: "Only member visibility tested; payments, recon, trusted devices, and ops tables untested." 
  fix: "Add SQL tests for each policy using existing fixtures and gate via CI." 
  effort: M
- id: OPS-010
  area: operations
  title: "Observability + preview coverage still incomplete"
  files: [".github/workflows/ci.yml", "scripts/analyze-bundle.mjs", "lib/audit.ts"]
  risk: medium
  evidence: "pnpm CI and Lighthouse budgets now run, but no structured log shipping or preview deployments exist; audit logger still swallows insert failures."
  fix: "Wire preview workflow with Supabase branch DB, export structured logs to Logflare/Splunk, and gate CI on audit writer health."
  effort: M
- id: QA-011
  area: testing
  title: "MFA factor facade lacks automated coverage"
  files: ["src/auth/factors/index.ts", "src/auth/factors/*.ts", "tests/e2e/auth.mfa.spec.ts"]
  risk: medium
  evidence: "New factor orchestrator powers /api/mfa/verify but has no unit tests and the Playwright MFA spec remains skipped, leaving regressions undetected."
  fix: "Add targeted unit tests for TOTP/email/backup adapters, wire replay guard integration tests, and enable Playwright MFA suite in CI."
  effort: M
