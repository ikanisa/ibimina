- id: SEC-001
  area: security
  title: "AuthX MFA verify missing rate limiting and replay guard"
  files: ["app/api/authx/challenge/verify/route.ts", "lib/authx/verify.ts"]
  risk: critical
  evidence: "AuthX verification loop lacks throttling and never persists last_mfa_step/failed_mfa_count, so attackers can brute-force or replay TOTP/backup codes." 
  fix: "Add per-user/IP rate limits, persist step counters + failure counts, align with legacy /api/mfa/verify semantics, and emit structured errors." 
  effort: M
- id: SEC-002
  area: security
  title: "WhatsApp OTP issuance unthrottled"
  files: ["lib/authx/start.ts"]
  risk: high
  evidence: "sendWhatsAppOtp inserts codes without rate limits or salted hashes, enabling spam and offline brute force if DB leaked." 
  fix: "Reuse email OTP throttling, add per-issuance salt, expire outstanding codes, and audit sends before enabling channel." 
  effort: M
- id: SEC-003
  area: security
  title: "Supabase Edge Functions expose unauthenticated ingress"
  files: ["supabase/config.toml"]
  risk: high
  evidence: "parse-sms, ingest-sms, sms-inbox, scheduled-reconciliation, metrics-exporter all set verify_jwt=false." 
  fix: "Enforce JWT or shared HMAC per function, log rejected requests, and document signature rotation." 
  effort: M
- id: REL-004
  area: reliability
  title: "Dual MFA stacks risk inconsistent state"
  files: ["components/auth/login-form.tsx", "app/api/mfa/verify/route.ts", "app/api/authx/challenge/verify/route.ts"]
  risk: high
  evidence: "Login posts to /api/mfa/* while AuthX endpoints skip failure counters and set different cookies, creating divergent MFA states." 
  fix: "Unify flows behind AuthX facade, migrate UI to new endpoints, and remove legacy routes after parity tests." 
  effort: L
- id: PWA-005
  area: pwa
  title: "Service worker precaches only partial shell"
  files: ["service-worker.js"]
  risk: high
  evidence: "Manual SW caches only /, /dashboard, /recon, manifest, and icons, skipping _next assets and dynamic routes." 
  fix: "Replace with workbox precaching of build assets + runtime caching for authed routes and offline fallback." 
  effort: M
- id: A11Y-006
  area: accessibility
  title: "Quick actions dialog lacks focus trap"
  files: ["components/layout/app-shell.tsx"]
  risk: medium
  evidence: "Overlay closes via click handlers without focus trap or ESC support, trapping keyboard users." 
  fix: "Implement focus management, keyboard dismissal, and aria-current on nav items." 
  effort: S
- id: PERF-007
  area: performance
  title: "Dashboard aggregates computed in memory"
  files: ["lib/dashboard.ts"]
  risk: high
  evidence: "Monthly summary pulls entire payment/member datasets into Node for aggregation, risking latency and memory issues." 
  fix: "Move aggregation into SQL views/materialised tables with pagination." 
  effort: M
- id: PERF-008
  area: performance
  title: "Next image optimisation disabled"
  files: ["next.config.ts"]
  risk: medium
  evidence: "images.unoptimized=true prevents CDN resizing for hero assets." 
  fix: "Enable optimisation or document CDN strategy with caching headers." 
  effort: S
- id: DATA-009
  area: data
  title: "RLS test coverage limited to members"
  files: ["supabase/tests/rls/sacco_staff_access.test.sql"]
  risk: medium
  evidence: "Only member visibility tested; payments, recon, trusted devices, and ops tables untested." 
  fix: "Add SQL tests for each policy using existing fixtures and gate via CI." 
  effort: M
- id: OPS-010
  area: operations
  title: "CI pipeline misaligned with pnpm and lacks auth e2e"
  files: [".github/workflows/ci.yml", "package.json"]
  risk: medium
  evidence: "Workflow runs npm ci despite pnpm lock and no Playwright/auth-focused checks."
  fix: "Switch to pnpm install/cache, add MFA e2e + Lighthouse budgets as blocking gates."
  effort: M
- id: QA-011
  area: testing
  title: "MFA factor facade lacks automated coverage"
  files: ["src/auth/factors/index.ts", "src/auth/factors/*.ts", "tests/e2e/auth.mfa.spec.ts"]
  risk: medium
  evidence: "New factor orchestrator powers /api/mfa/verify but has no unit tests and the Playwright MFA spec remains skipped, leaving regressions undetected."
  fix: "Add targeted unit tests for TOTP/email/backup adapters, wire replay guard integration tests, and enable Playwright MFA suite in CI."
  effort: M
