# ============================================================
# Netlify Environment Variables Template for SACCO+ Admin
# 
# Set these in Netlify via:
#   1. Netlify UI: Site settings â†’ Environment variables
#   2. Netlify CLI: netlify env:set KEY "value" --context production --scope builds functions
#
# IMPORTANT: All variables needed during build must include the "Builds" scope.
# Variables used in SSR/Functions must include the "Functions" scope.
# ============================================================

# ------------- REQUIRED FOR ALL CONTEXTS (development/preview/production) -------------

# Supabase project URL (browser + server)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co

# Supabase anon/public key (browser)
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here

# Supabase service-role key (server only)
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# ------------- REQUIRED FOR PRODUCTION ONLY -------------
# These are optional for preview/branch deploys, but MUST be set for production.
# Generate with: openssl rand -base64 32

# Pepper for backup code hashing (32+ bytes, base64)
BACKUP_PEPPER=<generate with: openssl rand -base64 32>

# Secret for MFA session cookies (32+ bytes, base64)
MFA_SESSION_SECRET=<generate with: openssl rand -base64 32>

# Secret for trusted device cookies (32+ bytes, base64)
TRUSTED_COOKIE_SECRET=<generate with: openssl rand -base64 32>

# HMAC secret for edge function/webhook verification (32+ bytes, base64)
HMAC_SHARED_SECRET=<generate with: openssl rand -base64 32>

# Base64-encoded 32-byte KMS data key for encrypting sensitive fields
KMS_DATA_KEY_BASE64=<generate with: openssl rand -base64 32>

# OpenAI API key for AI-assisted features (required in production)
OPENAI_API_KEY=sk-...

# ------------- OPTIONAL BUT RECOMMENDED -------------

# Runtime environment label
APP_ENV=production

# Canonical site URL (for passkeys and redirects)
NEXT_PUBLIC_SITE_URL=https://admin.sacco.plus

# Build ID for deterministic builds
NEXT_PUBLIC_BUILD_ID=netlify-build

# MFA email configuration
MFA_EMAIL_FROM=security@sacco.plus
MFA_EMAIL_LOCALE=en

# Observability
LOG_DRAIN_URL=https://your-log-drain.com/webhook
LOG_DRAIN_TOKEN=<your-log-drain-token>

# Error tracking (optional)
NEXT_PUBLIC_SENTRY_DSN=https://public@sentry.io/project
SENTRY_TRACES_SAMPLE_RATE=0.2
SENTRY_PROFILES_SAMPLE_RATE=0.1

# Analytics (optional)
POSTHOG_API_KEY=phc_your_posthog_key
POSTHOG_HOST=https://app.posthog.com

# ------------- NETLIFY CLI COMMANDS -------------
# Set production secrets (recommended approach):
#
# netlify env:set BACKUP_PEPPER "$(openssl rand -base64 32)" --context production --scope builds functions --secret
# netlify env:set MFA_SESSION_SECRET "$(openssl rand -base64 32)" --context production --scope builds functions --secret
# netlify env:set TRUSTED_COOKIE_SECRET "$(openssl rand -base64 32)" --context production --scope builds functions --secret
# netlify env:set HMAC_SHARED_SECRET "$(openssl rand -base64 32)" --context production --scope builds functions --secret
# netlify env:set KMS_DATA_KEY_BASE64 "$(openssl rand -base64 32)" --context production --scope builds functions --secret
# netlify env:set OPENAI_API_KEY "sk-..." --context production --scope builds functions --secret
#
# For preview/branch deploys (optional, uses safe fallbacks):
#
# netlify env:set BACKUP_PEPPER "$(openssl rand -base64 32)" --context deploy-preview branch-deploy --scope builds functions
# netlify env:set MFA_SESSION_SECRET "$(openssl rand -base64 32)" --context deploy-preview branch-deploy --scope builds functions
# netlify env:set TRUSTED_COOKIE_SECRET "$(openssl rand -base64 32)" --context deploy-preview branch-deploy --scope builds functions
# netlify env:set HMAC_SHARED_SECRET "$(openssl rand -base64 32)" --context deploy-preview branch-deploy --scope builds functions
# netlify env:set KMS_DATA_KEY_BASE64 "$(openssl rand -base64 32)" --context deploy-preview branch-deploy --scope builds functions
#
# Verify configuration:
#
# netlify env:list --context production --scope builds
# netlify env:list --context production --scope functions
#
# ------------- SECURITY NOTES -------------
# 1. NEVER prefix secrets with NEXT_PUBLIC_ (they will be exposed to the browser)
# 2. Use --secret flag when setting via CLI to prevent values from being read later
# 3. For public repos, configure Netlify's sensitive variable policy
# 4. Rotate secrets periodically
# 5. Use different values per deploy context (production vs previews)
