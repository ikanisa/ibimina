#!/usr/bin/env node
import fs from "node:fs";
import path from "node:path";

const localesDir = path.resolve("locales");

function loadJson(file) {
  const p = path.join(localesDir, file);
  const raw = fs.readFileSync(p, "utf8");
  return JSON.parse(raw);
}

function saveJson(file, obj) {
  const p = path.join(localesDir, file);
  const json = JSON.stringify(obj, null, 2) + "\n";
  fs.writeFileSync(p, json, "utf8");
}

function flatten(obj, prefix = "") {
  const out = {};
  for (const [k, v] of Object.entries(obj)) {
    const key = prefix ? `${prefix}.${k}` : k;
    if (v && typeof v === "object" && !Array.isArray(v)) {
      Object.assign(out, flatten(v, key));
    } else {
      out[key] = v;
    }
  }
  return out;
}

// Key updates for Kinyarwanda (rw)
const rwUpdates = {
  "common.email": "Email",
  "common.sending": "Birimo koherezwa…",
  "admin.invite.selectSacco": "Hitamo SACCO y’iyi nshingano",
  "admin.invite.fail": "Kohereza ubutumire byanze",
  "admin.invite.sentWithTemp": "Ubutumire bwoherejwe. Ijambobanga ry’igihe: ",
  "admin.invite.sent": "Ubutumire bwoherejwe neza",
  "admin.invite.notice": "Ubutumire bwoherejwe ku bakozi",
  "admin.invite.role": "Inshingano",
  "admin.invite.emailPlaceholder": "umukozi@sacco.rw",
  "admin.invite.send": "Ohereza ubutumire",
  "admin.registry.noRecord": "Nta nyandiko yatoranyijwe",
  "admin.registry.nameRequired": "Izina rirakenewe",
  "admin.registry.districtRequired": "Akarere kirakenewe",
  "admin.registry.sectorRequired": "Umurenge urakenewe",
  "admin.registry.provinceRequired": "Intara irakenewe",
  "admin.registry.created": "SACCO yaremwe",
  "admin.registry.updated": "SACCO yavuguruwe",
  "admin.registry.deleted": "SACCO yasibwe",
  "admin.registry.deleteConfirm": "Siba iyi SACCO? Ntibisubirwaho.",
  "admin.registry.deleteFailed": "Gusiba SACCO byanze",
  "admin.registry.searchPlaceholder": "Shakisha izina, akarere",
  "admin.registry.new": "SACCO nshya",
  "table.name": "Izina",
  "table.district": "Akarere",
  "table.province": "Intara",
  "table.status": "Imiterere",
  "table.actions": "Ibikorwa",
  "table.sector": "Umurenge",
  "admin.registry.none": "Nta SACCO ihuye n’ubu bushakashatsi.",
  "admin.registry.createTitle": "Kora SACCO",
  "admin.registry.editTitle": "Hindura SACCO",
  "admin.registry.category": "Icyiciro",
  "common.close": "Funga",
  "common.cancel": "Kureka",
  "common.save": "Bika",
  "common.create": "Kora",
  "common.saving": "Birimo kubika…",
  "common.operationFailed": "Igikorwa cyanze",
  "admin.templates.loadFailed": "Kuzana inyandiko byanze",
  "admin.templates.selectSacco": "Banza uhitemo SACCO",
  "admin.templates.nameRequired": "Izina ry’inyandiko rirakenewe",
  "admin.templates.bodyRequired": "Umwandiko w’imbere urakenewe",
  "admin.templates.createFailed": "Gukora inyandiko byanze",
  "admin.templates.created": "Inyandiko yakozwe",
  "admin.templates.updateFailed": "Kuvugurura inyandiko byanze",
  "admin.templates.activated": "Inyandiko yakoreshejwe",
  "admin.templates.deactivated": "Inyandiko yahagaritswe",
  "admin.templates.deleteConfirm": "Siba iyi nyandiko?",
  "admin.templates.deleteFailed": "Gusiba inyandiko byanze",
  "admin.templates.deleted": "Inyandiko yasibwe",
  "admin.templates.description": "Ibisobanuro",
  "admin.templates.descriptionPlaceholder": "Kwibutsa imisanzu ya buri cyumweru",
  "admin.templates.create": "Kora inyandiko",
  "admin.templates.count": "inyandiko",
  "admin.templates.for": "ya",
  "admin.templates.empty": "Nta nyandiko zirahari. Tangira ukoreshe imwe hejuru.",
  "admin.templates.newVersion": "Verisiyo nshya",
  "admin.templates.sendTest": "Ohereza SMS y’ikizamini",
  "admin.templates.queueHint": "Iteka igikorwa mu murongo w’amatangazo",
  "common.delete": "Siba",
  "common.active": "Gikora",
  "common.inactive": "Kidakora",
  "common.creating": "Birimo gukora…",
  "admin.users.updated": "Umukoresha yavuguruwe",
  "admin.users.reminderFailed": "Kwibutsa byanze",
  "admin.users.reminderQueued": "Kwibutsa byashyizwe mu murongo",
  "admin.users.mfaManaged": "Bigenzurwa muri porofayi",
  "admin.users.send2faReminder": "Ohereza kwibutsa 2FA",
  "common.created": "Byakozwe",
  "admin.queue.empty": "Nta matangazo ari mu murongo.",
  "admin.queue.event": "Icyabaye",
  "admin.queue.sacco": "SACCO",
  "admin.queue.template": "Inyandiko",
  "admin.queue.queued": "Byashyizwe mu murongo",
  "admin.queue.scheduled": "Biteganyijwe",
  "admin.audit.empty": "Nta nyandiko z’igenzura.",
  "admin.audit.actor": "Uwakoze:",
  "admin.audit.entityId": "ID y’ikintu:",
  "reports.errors.invalidDates": "Itariki z’uyunguruzo zitemewe",
  "reports.errors.startBeforeEnd": "Itariki itangira igomba kuba mbere y’isoza",
  "reports.errors.loadFailed": "Kwinjiza ishusho byanze",
  "reports.filters.saccoPlaceholder": "Shungura ku SACCO",
  "common.networkError": "Ikosa rya murandasi",
  "common.edit": "Hindura",
  "auth.errors.signIn": "Kwinjira byanze",
  "auth.errors.noSession": "Nta session ibonetse",
  "auth.errors.status": "Imiterere y’ukwinjira itazwi",
  "auth.success.redirect": "Urahita woherezwa",
  "auth.errors.startEnroll": "Gutangiza kwiyandikisha byanze",
  "auth.enroll.scanMessage": "Sikana QR ukoresheje porogaramu ya Authenticator",
  "auth.challenge.prompt": "Andika kode ya Authenticator",
  "auth.errors.enterCode": "Shyiramo kode",
  "auth.errors.invalidCode": "Kode si yo",
  "auth.errors.rateLimit": "Wagerageje kenshi; ongera ugerageze nyuma",
  "auth.errors.verifyCode": "Kwemeza kode byanze",
  "auth.errors.enterTwoCodes": "Shyiramo amakode abiri",
  "auth.errors.invalidCodes": "Amakode si yo",
  "auth.errors.confirmEnroll": "Kwemeza kwiyandikisha byanze",
  "auth.enroll.verifiedNextCode": "Kanda winjize kode ikurikiraho",
  "auth.email.label": "Email",
  "auth.email.placeholder": "wowe@urugero.rw",
  "auth.password.label": "Ijambobanga",
  "auth.enroll.intro": "Shyiraho 2FA ukoresheje porogaramu ya Authenticator.",
  "auth.enroll.qrAlt": "QR y’iyandikisha",
  "auth.enroll.scanInstruction":
    "Sikana QR ukoresheje Google Authenticator cyangwa indi porogaramu",
  "auth.enroll.step1": "Fungura porogaramu ya Authenticator",
  "auth.enroll.step2": "Sikana QR hejuru",
  "auth.enroll.step3": "Shyiramo amakode abiri akurikirana",
  "auth.enroll.openInApp": "Fungura muri porogaramu",
  "auth.enroll.secretLabel": "Ijambo ry’ibanga",
  "auth.enroll.enterTwoCodes": "Shyiramo amakode abiri",
  "auth.enroll.code1": "Kode 1",
  "auth.enroll.code2": "Kode 2",
  "auth.enroll.preparing": "Kwitegura…",
  "auth.challenge.rotate": "Hindura igikoresho",
  "auth.challenge.backupCode": "Kode y’inyunganizi",
  "auth.challenge.authCode": "Kode ya Authenticator",
  "auth.challenge.trustDevice": "Igikoresho wizeye",
  "auth.challenge.useBackup": "Koresha kode y’inyunganizi",
  "auth.challenge.useAuthenticator": "Koresha Authenticator",
  "auth.backup.title": "Kode z’inyunganizi",
  "auth.backup.storeInfo": "Bika neza izi kode; zikoreshwa rimwe gusa.",
  "auth.buttons.processing": "Birimo gutunganywa…",
  "auth.buttons.signIn": "Injira",
  "auth.buttons.confirmSetup": "Emeza ishyirwaho",
  "auth.buttons.verifyCode": "Emeza kode",
  "auth.buttons.cancelAndSignInAgain": "Reka unyinjiremo nanone",
  "common.actions": "Ibikorwa",
  "common.selectAll": "Hitamo byose",
  "common.searchFailed": "Gushakisha byanze",
};

// Key updates for French (fr)
const frUpdates = {
  "common.email": "E-mail",
  "common.sending": "Envoi en cours…",
  "admin.invite.selectSacco": "Sélectionnez un SACCO pour ce rôle",
  "admin.invite.fail": "Invitation échouée",
  "admin.invite.sentWithTemp": "Invitation envoyée. Mot de passe temporaire : ",
  "admin.invite.sent": "Invitation envoyée",
  "admin.invite.notice": "Invitation envoyée au personnel",
  "admin.invite.role": "Rôle",
  "admin.invite.emailPlaceholder": "agent@sacco.rw",
  "admin.invite.send": "Envoyer l’invitation",
  "admin.registry.noRecord": "Aucun enregistrement sélectionné",
  "admin.registry.nameRequired": "Le nom est requis",
  "admin.registry.districtRequired": "Le district est requis",
  "admin.registry.sectorRequired": "Le secteur est requis",
  "admin.registry.provinceRequired": "La province est requise",
  "admin.registry.created": "SACCO créé",
  "admin.registry.updated": "SACCO mis à jour",
  "admin.registry.deleted": "SACCO supprimé",
  "admin.registry.deleteConfirm": "Supprimer ce SACCO ? Cette action est irréversible.",
  "admin.registry.deleteFailed": "Échec de suppression du SACCO",
  "admin.registry.searchPlaceholder": "Rechercher par nom, district",
  "admin.registry.new": "Nouveau SACCO",
  "table.name": "Nom",
  "table.district": "District",
  "table.province": "Province",
  "table.status": "Statut",
  "table.actions": "Actions",
  "table.sector": "Secteur",
  "admin.registry.none": "Aucun SACCO ne correspond à cette recherche.",
  "admin.registry.createTitle": "Créer un SACCO",
  "admin.registry.editTitle": "Modifier le SACCO",
  "admin.registry.category": "Catégorie",
  "common.close": "Fermer",
  "common.cancel": "Annuler",
  "common.save": "Enregistrer",
  "common.create": "Créer",
  "common.saving": "Enregistrement…",
  "common.operationFailed": "Échec de l’opération",
  "admin.templates.loadFailed": "Échec du chargement des modèles",
  "admin.templates.selectSacco": "Sélectionnez d’abord un SACCO",
  "admin.templates.nameRequired": "Le nom du modèle est requis",
  "admin.templates.bodyRequired": "Le corps du modèle est requis",
  "admin.templates.createFailed": "Échec de création du modèle",
  "admin.templates.created": "Modèle créé",
  "admin.templates.updateFailed": "Échec de mise à jour du modèle",
  "admin.templates.activated": "Modèle activé",
  "admin.templates.deactivated": "Modèle désactivé",
  "admin.templates.deleteConfirm": "Supprimer ce modèle ?",
  "admin.templates.deleteFailed": "Échec de suppression du modèle",
  "admin.templates.deleted": "Modèle supprimé",
  "admin.templates.description": "Description",
  "admin.templates.descriptionPlaceholder": "Rappel des contributions hebdomadaires",
  "admin.templates.create": "Créer un modèle",
  "admin.templates.count": "modèle(s)",
  "admin.templates.for": "pour",
  "admin.templates.empty": "Aucun modèle pour l’instant. Créez-en un ci-dessus.",
  "admin.templates.newVersion": "Nouvelle version",
  "admin.templates.sendTest": "Envoyer un SMS de test",
  "admin.templates.queueHint": "Met un événement en file dans le pipeline de notification",
  "common.delete": "Supprimer",
  "common.active": "Actif",
  "common.inactive": "Inactif",
  "common.creating": "Création…",
  "admin.users.updated": "Utilisateur mis à jour",
  "admin.users.reminderFailed": "Rappel échoué",
  "admin.users.reminderQueued": "Rappel en file d’attente",
  "admin.users.mfaManaged": "Géré dans le profil",
  "admin.users.send2faReminder": "Envoyer un rappel 2FA",
  "common.created": "Créé",
  "admin.queue.empty": "Aucune notification en file d’attente.",
  "admin.queue.event": "Événement",
  "admin.queue.sacco": "SACCO",
  "admin.queue.template": "Modèle",
  "admin.queue.queued": "En file",
  "admin.queue.scheduled": "Planifié",
  "admin.audit.empty": "Aucun enregistrement d’audit.",
  "admin.audit.actor": "Acteur :",
  "admin.audit.entityId": "ID de l’entité :",
  "common.networkError": "Erreur réseau",
  "common.edit": "Modifier",
  "auth.errors.signIn": "Échec de la connexion",
  "auth.errors.noSession": "Aucune session",
  "auth.errors.status": "Statut de connexion inconnu",
  "auth.success.redirect": "Redirection en cours",
  "auth.errors.startEnroll": "Échec du démarrage de l’inscription",
  "auth.enroll.scanMessage": "Scannez le QR avec votre application d’authentification",
  "auth.challenge.prompt": "Saisissez le code de l’authentificateur",
  "auth.errors.enterCode": "Saisissez le code",
  "auth.errors.invalidCode": "Code invalide",
  "auth.errors.rateLimit": "Trop de tentatives ; réessayez plus tard",
  "auth.errors.verifyCode": "Échec de vérification du code",
  "auth.errors.enterTwoCodes": "Saisissez deux codes",
  "auth.errors.invalidCodes": "Codes invalides",
  "auth.errors.confirmEnroll": "Échec de confirmation de l’inscription",
  "auth.enroll.verifiedNextCode": "Saisissez le code suivant",
  "auth.email.label": "E‑mail",
  "auth.email.placeholder": "vous@exemple.rw",
  "auth.password.label": "Mot de passe",
  "auth.enroll.intro": "Activez la 2FA avec une application d’authentification.",
  "auth.enroll.qrAlt": "QR d’inscription",
  "auth.enroll.scanInstruction": "Scannez le QR avec Google Authenticator ou équivalent",
  "auth.enroll.step1": "Ouvrez votre application d’authentification",
  "auth.enroll.step2": "Scannez le QR ci-dessus",
  "auth.enroll.step3": "Saisissez deux codes consécutifs",
  "auth.enroll.openInApp": "Ouvrir dans l’app",
  "auth.enroll.secretLabel": "Clé secrète",
  "auth.enroll.enterTwoCodes": "Saisissez deux codes",
  "auth.enroll.code1": "Code 1",
  "auth.enroll.code2": "Code 2",
  "auth.enroll.preparing": "Préparation…",
  "auth.challenge.rotate": "Changer d’appareil",
  "auth.challenge.backupCode": "Code de secours",
  "auth.challenge.authCode": "Code d’authentification",
  "auth.challenge.trustDevice": "Appareil de confiance",
  "auth.challenge.useBackup": "Utiliser un code de secours",
  "auth.challenge.useAuthenticator": "Utiliser l’authentificateur",
  "auth.backup.title": "Codes de secours",
  "auth.backup.storeInfo": "Conservez ces codes en lieu sûr ; ils sont à usage unique.",
  "auth.buttons.processing": "Traitement…",
  "auth.buttons.signIn": "Se connecter",
  "auth.buttons.confirmSetup": "Confirmer la configuration",
  "auth.buttons.verifyCode": "Vérifier le code",
  "auth.buttons.cancelAndSignInAgain": "Annuler et se reconnecter",
  "common.actions": "Actions",
  "common.selectAll": "Tout sélectionner",
  "common.searchFailed": "Échec de la recherche",
};

function applyUpdates(localeFile, updates) {
  const current = flatten(loadJson(localeFile));
  const merged = { ...current, ...updates };
  const sorted = Object.fromEntries(
    Object.keys(merged)
      .sort()
      .map((k) => [k, merged[k]])
  );
  saveJson(localeFile, sorted);
}

applyUpdates("rw/common.json", rwUpdates);
applyUpdates("fr/common.json", frUpdates);

console.log("Updated translations for rw and fr locales.");
