Variable,Scope,Used By,Required,Default/Example,Notes
NEXT_PUBLIC_SUPABASE_URL,web:client|web:server,"lib/supabase/client.tsx; lib/supabase/config.ts",yes,https://<project>.supabase.co,"Browser + server Supabase clients; must match Supabase project URL."
NEXT_PUBLIC_SUPABASE_ANON_KEY,web:client|web:server,"lib/supabase/client.tsx; lib/supabase/config.ts",yes,anon-public-key,"Anon key exposed to browser; keep RLS enabled."
NEXT_PUBLIC_SITE_URL,web:client,"lib/mfa/passkeys.ts",no,https://app.example.com,"Override passkey origin when the canonical host differs from localhost."
NEXT_PUBLIC_BUILD_ID,web:client,"next.config.ts",no,auto,"Injected during build to surface git SHA/version in the UI."
NEXT_PUBLIC_E2E,web:client,"providers/offline-queue-provider.tsx",no,1,"Playwright-only flag to relax offline queue safeguards."
SUPABASE_SERVICE_ROLE_KEY,web:server|supabase:function,"lib/supabase/admin.ts; supabase/functions/_shared/mod.ts",yes,<service-role-key>,"Server-side Supabase access; identical secret must exist in the web runtime and Supabase functions."
SUPABASE_JWT_SECRET,web:server,"src/env.server.ts",conditional,<jwt-secret>,"Optional Supabase JWT secret for server-side token validation."
SUPABASE_URL,supabase:function,"supabase/functions/_shared/mod.ts",yes,https://<project>.supabase.co,"Supabase REST endpoint for edge functions; mirrors NEXT_PUBLIC_SUPABASE_URL."
BACKUP_PEPPER,web:server,"lib/auth/util/crypto.ts; lib/mfa/crypto.ts",yes,<random-base64>,"Global pepper for OTP hashing and rate limit signatures."
RATE_LIMIT_SECRET,web:server,"lib/auth/util/crypto.ts",conditional,<random-base64>,"Optional override for rate limiting HMAC; falls back to BACKUP_PEPPER when unset."
EMAIL_OTP_PEPPER,web:server,"lib/mfa/email.ts",conditional,<random-base64>,"Optional email OTP pepper; defaults to BACKUP_PEPPER."
MFA_SESSION_SECRET,web:server,"lib/mfa/session.ts",yes,<random-string>,"Signs short-lived MFA session cookies."
TRUSTED_COOKIE_SECRET,web:server,"lib/mfa/session.ts",yes,<random-string>,"Signs trusted-device cookies."
MFA_SESSION_TTL_SECONDS,web:server,"lib/mfa/session.ts",no,43200,"Lifetime (seconds) for MFA session cookie; must be positive integer."
TRUSTED_DEVICE_TTL_SECONDS,web:server,"lib/mfa/session.ts",no,2592000,"Lifetime (seconds) for trusted-device cookie; must be positive integer."
MFA_RP_ID,web:server,"lib/mfa/passkeys.ts",conditional,app.example.com,"Override WebAuthn relying party ID when auto-detection fails."
MFA_ORIGIN,web:server,"lib/mfa/passkeys.ts",conditional,https://app.example.com,"Force WebAuthn origin; defaults to SITE_URL or NEXT_PUBLIC_SITE_URL."
MFA_RP_NAME,web:server,"lib/mfa/passkeys.ts",no,SACCO+,"Display name for WebAuthn relying party."
MFA_EMAIL_LOCALE,web:server|supabase:function,"lib/mfa/email.ts; supabase/functions/mfa-email",no,en,"Default locale for MFA email copy."
MFA_EMAIL_FROM,web:server|supabase:function,"lib/mfa/email.ts; supabase/functions/mfa-email",yes,security@example.com,"Sender email used for OTP mailers; must align with verified domain."
HMAC_SHARED_SECRET,web:server|supabase:function,"supabase/functions/_shared/auth.ts; scripts/postdeploy-verify.sh",yes,<shared-secret>,"Timestamped HMAC for webhook authentication; identical across runtimes."
OPENAI_API_KEY,web:server|supabase:function,"app/api/ocr/upload/route.ts; supabase/functions/parse-sms",yes,sk-...,"OpenAI Responses API key for OCR and SMS parsing."
OPENAI_OCR_MODEL,web:server,"app/api/ocr/upload/route.ts",no,gpt-4.1-mini,"Model name for OCR endpoint; must be available in configured OpenAI account."
OPENAI_RESPONSES_MODEL,web:server|supabase:function,"lib/openai.ts; supabase/functions/_shared/sms-parser.ts",no,gpt-4.1-mini,"Structured JSON model used for SMS parsing + analytics."
KMS_DATA_KEY,web:server,"lib/mfa/crypto.ts",conditional,<base64-32-byte>,"Primary 32-byte base64 key for encrypting MFA secrets; one of KMS_DATA_KEY/KMS_DATA_KEY_BASE64 must be set."
KMS_DATA_KEY_BASE64,web:server|supabase:function,"lib/mfa/crypto.ts; supabase/functions/_shared/crypto.ts",conditional,<base64-32-byte>,"Legacy alias for MFA/data encryption key; ensure value decodes to 32 bytes."
FIELD_ENCRYPTION_KEY,supabase:function,"supabase/functions/_shared/crypto.ts",conditional,<base64-32-byte>,"Fallback alias for the KMS data key when using older Supabase deployments."
ANALYTICS_CACHE_TOKEN,web:server,"app/api/cache/revalidate/route.ts",conditional,<token>,"Bearer token required to trigger cache revalidation; omit to disable endpoint."
REPORT_SIGNING_KEY,web:server|supabase:function,"app/api/reports/export/route.ts; supabase/functions/reports-export",conditional,<hex-secret>,"Optional HMAC secret for signed CSV exports."
MAIL_FROM,web:server,"docs/AUTH-SETUP.md",no,"SACCO+ <no-reply@sacco.plus>","Default sender when SMTP is configured instead of Supabase Resend function."
SMTP_HOST,web:server,"docs/AUTH-SETUP.md",no,smtp.sendgrid.net,"Optional SMTP host for fallback email delivery."
SMTP_PORT,web:server,"docs/AUTH-SETUP.md",no,587,"SMTP port when using legacy email pipeline."
SMTP_USER,web:server,"docs/AUTH-SETUP.md",no,<username>,"Optional SMTP auth user."
SMTP_PASS,web:server,"docs/AUTH-SETUP.md",no,<password>,"Optional SMTP auth password."
LOG_DRAIN_URL,web:server,"lib/observability/logger.ts",conditional,https://logs.example.com/ingest,"HTTP endpoint for structured log forwarding."
LOG_DRAIN_TOKEN,web:server,"lib/observability/logger.ts",conditional,<token>,"Auth token included when forwarding logs."
LOG_DRAIN_SOURCE,web:server,"lib/observability/logger.ts",conditional,next-api,"Source identifier for log drain payloads."
LOG_DRAIN_TIMEOUT_MS,web:server,"lib/observability/logger.ts",no,2000,"Timeout (ms) for log drain HTTP requests."
LOG_DRAIN_ALERT_WEBHOOK,web:server,"lib/observability/logger.ts",conditional,https://hooks.example.com/drain,"Webhook invoked on repeated drain failures."
LOG_DRAIN_ALERT_TOKEN,web:server,"lib/observability/logger.ts",conditional,<token>,"Auth token for alert webhook."
LOG_DRAIN_ALERT_COOLDOWN_MS,web:server,"lib/observability/logger.ts",no,300000,"Minimum delay (ms) between alert webhook triggers."
LOG_DRAIN_SILENT,web:server,"lib/observability/logger.ts",no,1,"Set to 1 to silence console warnings when the drain is unreachable (local dev only)."
TWILIO_ACCOUNT_SID,web:server,"lib/authx/start.ts",conditional,AC...,"WhatsApp/SMS automation integration; optional."
TWILIO_AUTH_TOKEN,web:server,"lib/authx/start.ts",conditional,<token>,"Twilio auth token for authx notifications."
TWILIO_WHATSAPP_FROM,web:server,"lib/authx/start.ts",no,whatsapp:+14155238886,"Default Twilio sender for WhatsApp outbound messages."
SITE_URL,web:server,"lib/mfa/passkeys.ts",conditional,https://app.example.com,"Explicit site origin when the canonical domain differs from localhost."
EDGE_URL,web:server,"scripts/postdeploy-verify.sh",conditional,https://<functions>.supabase.co,"Base URL for Supabase edge functions used in smoke tests."
DISABLE_PWA,web:server,"next.config.ts",no,1,"Set to 1 to skip PWA service worker bundling."
ANALYZE_BUNDLE,web:server,"next.config.ts",no,1,"Enables bundle analyzer plugin for diagnostics."
APP_ENV,web:server,"src/env.server.ts",no,local,"Deployment descriptor (local/staging/production) forwarded to logs and health checks."
APP_COMMIT_SHA,web:server,"next.config.ts",no,<sha>,"Optional git SHA injected during builds for diagnostics."
APP_REGION,web:server,"app/api/healthz/route.ts",no,<region>,"Human-readable region identifier reported in health endpoints."
PORT,web:server,"package.json scripts",no,3000,"Port bound by `pnpm start`; defaults to 3000 when unset."
ADMIN_API_TOKEN,supabase:function,"supabase/functions/generate-mfa-code",conditional,<token>,"Allows privileged automation (bootstrap admin flows)."
APP_ORIGIN,supabase:function,"supabase/functions/export-report",conditional,https://app.example.com,"CORS allowlist for export/reconciliation functions."
FORECAST_LOOKBACK_DAYS,supabase:function,"supabase/functions/analytics-forecast",no,120,"Historical window (days) for forecasting job."
FORECAST_HORIZON_DAYS,supabase:function,"supabase/functions/analytics-forecast",no,21,"Forecast horizon (days) for analytics job."
RATE_LIMIT_WINDOW_SECONDS,supabase:function,"supabase/functions/_shared/rate-limit.ts",no,60,"Rate limit rolling window (seconds) for Supabase functions."
RATE_LIMIT_MAX,supabase:function,"supabase/functions/_shared/rate-limit.ts",no,120,"Maximum requests allowed per window for Supabase functions."
RECON_AUTO_ESCALATE_HOURS,supabase:function,"supabase/functions/scheduled-reconciliation",no,48,"Auto-escalation threshold (hours) for reconciliation job."
SMS_AUTOMATION_THRESHOLD_MINUTES,supabase:function,"supabase/functions/gsm-maintenance",no,10,"Delay (minutes) before GSM automation is considered stale."
SMS_AUTOMATION_BATCH,supabase:function,"supabase/functions/gsm-maintenance",no,25,"Maximum batch size for GSM automation polling."
RESEND_API_KEY,supabase:function,"supabase/functions/mfa-email",yes,<resend-key>,"Resend API key used by MFA email function."
PLAYWRIGHT_BASE_URL,ci/test,"playwright.config.ts",no,http://127.0.0.1:3000,"Override base URL for Playwright tests."
PLAYWRIGHT_SUPABASE_URL,ci/test,"playwright.config.ts",no,http://127.0.0.1:54321,"Local Supabase URL for e2e tests."
PLAYWRIGHT_SUPABASE_ANON_KEY,ci/test,"playwright.config.ts",no,stub-anon-key,"Anon key used during Playwright runs."
PLAYWRIGHT_SUPABASE_SERVICE_ROLE_KEY,ci/test,"playwright.config.ts",no,stub-service-role-key,"Stub service-role key to satisfy env validation in e2e harness."
PLAYWRIGHT_OPENAI_API_KEY,ci/test,"playwright.config.ts",no,stub-openai-key,"Stub OpenAI key for local Playwright server process."
PLAYWRIGHT_HMAC_SHARED_SECRET,ci/test,"playwright.config.ts",no,stub-hmac-secret,"Stub HMAC secret for Playwright boot server."
AUTH_E2E_STUB,ci/test|web:server,"lib/auth.ts",conditional,1,"Enables fake auth flows during e2e tests; bypasses Supabase."
E2E_BACKUP_PEPPER,ci/test,"playwright.config.ts",no,playwright-pepper,"Stub pepper injected for Playwright server startup."
E2E_MFA_SESSION_SECRET,ci/test,"playwright.config.ts",no,stub-session-secret,"Stub secret used for Playwright MFA cookie tests."
E2E_TRUSTED_COOKIE_SECRET,ci/test,"playwright.config.ts",no,stub-trusted-secret,"Stub trusted-device secret for Playwright harness."
E2E_RATE_LIMIT_SECRET,ci/test,"playwright.config.ts",no,playwright-rate-limit,"Stub rate-limit HMAC secret for Playwright harness."
E2E_KMS_DATA_KEY,ci/test,"playwright.config.ts",no,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=,"Stub 32-byte base64 key for local MFA crypto tests."
CI,ci/test,"playwright.config.ts",no,true,"Used to adjust Playwright retries + server reuse inside CI."
NODE_ENV,web:server,"next.config.ts",yes,development,"Runtime mode (development/test/production); influences caching + PWA flags."
